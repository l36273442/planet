<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <link rel="stylesheet" href="../css/reset.css">
    <!--[if lt IE 9]>
    <script src="../js/html5.min.js"></script>
    <![endif]-->
    <script type="text/javascript" src="../js/zepto.min.js"></script>
    <script>
        //移动适配
        var desW = 750;
        var winW = document.documentElement.clientWidth;
        document.documentElement.style.fontSize = winW/desW*100+"px";
    </script>

    <style>
        .background{
            height: 8rem;
            margin-bottom: 0.34rem;
            background: url("../images/bg.png") no-repeat;
            background-size: 100% 100%;
        }
        .header{
            float: left;
            width: 100%;
            height: 0.58rem;
            line-height: 0.58rem;
            margin: 0.64rem 0 0.2rem 0;
            background: #2a1a49;
        }
        .message{
            display: inline-block;
            width: 0.4rem;
            height: 0.36rem;
            margin: 0.12rem 0.38rem;
            background: url("../images/广播@2x.png") no-repeat;
            background-size: 100% 100%;
        }
        marquee{
            display: inline-block;
            width: 80%;
            font-size: 0.26rem;
            color: #fff;
        }
        .user,.value{
            clear: both;
            color: #fff;
            overflow: hidden;
            position: relative;
            height: 0.48rem;
            padding-left: 0.38rem;
        }
        .energy,.hashrate{
            width: 0.4rem;
            height: 0.4rem;
        }
        .prana,.totalPoewer,.total,.hashrateText{
            font-size: 0.24rem;
            line-height: 0.46rem;
            display: inline-block;
        }
       .cheats{
           width: 1.65rem;
           height: 0.44rem;
           line-height: 0.44rem;
           border: 1px solid #fff;
           border-radius: 30px;
           font-size: 0.26rem;
           color: #fff;
           position: absolute;
           text-align: center;
           right: -0.3rem;
           cursor: pointer;
        }

        /* 能量 */
        .totalEnergy{
            position: relative;
        }
        .random{
            position: relative;
        }
        .random img {
            width: 1.18rem;
            height: 1.34rem;
            background-size: 100% 100%;
        }
        .random span{
	        text-align:center;
            position: absolute;
            left: 0.1rem;
            top: 0.5rem;
            color: #fff;
        }
        #y_0,#y_1,#y_2,#y_3,#y_4,#y_5{
            width: 1.2rem;
            height: 1.4rem;
            float: left;
        }

       #y_0{
           position: absolute;
           left: 0.1rem;
           top: 1.3rem;
        }
       #y_1{
           position: absolute;
           left: 4.5rem;
           top: 2.5rem;
        }
       #y_2{
           position: absolute;
           left: 3rem;
           top: 1.6rem;
        }
        #y_3{
            position: absolute;
            right: 0.2rem;
            top: -0.2rem;
        }
        #y_4{
            position: absolute;
            left: 1.3rem;
            top: 2.5rem;
        }
        #y_5{
            position: absolute;
            left: 2rem;
            top: 0;
        }

        .threeCircle{
            position: absolute;
            top: 6.5rem;
            width: 100%;
        }
        .circle{
            float: left;
            width: 0.8rem;
            height: 0.8rem;
            margin: 0 0.2rem;
            background: #51decd;
            border-radius: 50%;
            cursor: pointer;
        }
	.share{
            float: right;
            margin-right: 0.35rem;
            background: #60abe4;
        }
        .circle img{
            background-size: 100% 100%;
            width: 0.46rem;
	    height:0.46rem;
            margin: 0.16rem;
	    
        }
        .circle p{
            color: #fff;
            font-size: 0.22rem;
            line-height: 0.46rem;
            width: 1rem;
        }
        .ranking{
            height: 0.7rem;
            line-height: 0.7rem;
            color: #000;
            padding: 0 0.42rem;
            font-size: 0.28rem;
        }
        .rankingBg{
            height: 0.96rem;
            background: url("../images/排行榜@2x.png") no-repeat;
            background-size: 100% 100%;
        }
        .rank{
            width: 33.3%;
            float: left;
            color: #fff;
            font-size: 0.3rem;
            line-height: 0.96rem;
            text-align: center;
        }
        .powerRankings{
            overflow: auto;
            margin-bottom: 1.5rem;
        }
        .power{
            width: 100%;
            margin-left: 0.3rem;
            float: left;
            height: 0.66rem;
            line-height: 0.66rem;
            border-bottom: 1px solid #666;
        }
        .power span{
            float: left;
            width: 31%;
            color: #333;
            font-size: 0.22rem;
            text-align: center;
            line-height: 0.66rem;
        }
        .power .grey{
            color: #5f5f5f;
        }
       .Place{
            display: inline-block;
            position: absolute;
        }
        /*.goldMedal{
            background: url(../images/金牌@2x.png) no-repeat;
            background-size: 100% 100%;
            margin-top: 0.15rem;
            width: 0.3rem;
            height: 0.3rem;
            float: left;
        }
        .silverMedal{
            background: url("../images/银牌@2x.png")no-repeat;
            background-size: 100% 100%;
            margin-top: 0.15rem;
            width: 0.3rem;
            height: 0.3rem;
            float: left;
        }
        .copperMedal{
            background: url("../images/铜牌@2x.png")no-repeat;
            background-size: 100% 100%;
            margin-top: 0.15rem;
            width: 0.3rem;
            height: 0.3rem;
            float: left;
        }*/
        .powerRankings li:nth-child(1) i{
             background: url("../images/金牌@2x.png") no-repeat;
             background-size: 100% 100%;
             margin-top: 0.15rem;
             width: 0.3rem;
             height: 0.3rem;
             float: left;
         }
        .powerRankings li:nth-child(2) i{
            background: url("../images/银牌@2x.png")no-repeat;
            background-size: 100% 100%;
            margin-top: 0.15rem;
            width: 0.3rem;
            height: 0.3rem;
            float: left;
        }
        .powerRankings li:nth-child(3) i{
            background: url("../images/铜牌@2x.png")no-repeat;
            background-size: 100% 100%;
            margin-top: 0.15rem;
            width: 0.3rem;
            height: 0.3rem;
            float: left;
        }
        .footer{
            position: fixed;
            width: 100%;
            bottom: 0;
            height: 1rem;
            background: #fff;
            border-top: 1px solid #ddd;
        }
        .community{
            float: left;
            margin-top: 0.05rem;
            width: 49%;
            cursor: pointer
        }
        .community div{
            width: 0.6rem;
            height: 0.6rem;
            margin: 0 41%;
        }
        .community div img{
            width: 100%;
            height: 100%;
            background-size: 100% 100%;
        }
        .community span{
            float: left;
            width: 100%;
            font-size: 0.2rem;
            text-align: center;
        }
        .gray{
            color: #919ba4;
        }
        .blue{
            color: #329de1;
        }
        .empty{
            margin-right: 1rem;
            font-style: normal;
        }
        .mask{
            width: 100%;
            height: 4rem;
            background: transparent;
            z-index: 10;
            position: absolute;
            display: none;
        }
    </style>
</head>
<body>
<div class="background">
    <audio src="../images/能量4.mp3" id="audio"></audio>

    <div class="header">
        <span class="message"></span>
       <!-- <marquee scrollamount="3">MIntBit交易所8月18日上线，免手续费</marquee>-->
    </div>
    <p class="user">
        <img src="../images/能量大@2x.png" class="energy">
        <span class="prana">能量</span>
        <span class="total"></span>
        <a href="./cheats.html" class="cheats">秘籍</a>
    </p>
    <p class="value">
        <img src="../images/算力小@3x.png" class="hashrate">
        <span class="hashrateText">算力值</span>
        <span class="totalPoewer"></span>
    </p>

    <!-- 算力 -->
    <div class="totalEnergy">
        <div id="y_0"></div>
        <div id="y_1"></div>
        <div id="y_2"></div>
        <div id="y_3"></div>
        <div id="y_4"></div>
        <div id="y_5"></div>
        <div class="mask"></div>
    </div>

    <ul class="threeCircle">
        <li class="circle promotePower">
            <img src="../images/算力.png">
            <p>提升算力</p>
        </li>
        <li class="circle activity">
            <img src="../images/活动.png">
            <p>星球活动</p>
        </li>
        <li class="circle share">
            <img src="../images/分享.png">
            <p style="text-align: center;width: 0.8rem;">分享</p>
        </li>
    </ul>

    <!-- 时间 -->
    <!--<p class="time">更新于2018.05.30 12点</p>-->
</div>

<!-- 排行信息 -->
<P class="ranking">能量排行榜</P>
<ul class="rankingBg">
    <li class="rank">名次</li>
    <li class="rank">能量</li>
    <li class="rank">算力</li>
</ul>

<!-- 排行榜 -->
<ul class="powerRankings">
   <!-- <li class="power">
       <i class="Place goldMedal"></i>
       <span>区块链王阿姨</span>
       <span>999.99</span>
       <span>99.99</span>
   </li>
    <li class="power">
        <i class="Place silverMedal"></i>
        <span>区块链王阿姨</span>
        <span>999.99</span>
        <span>99.99</span>
    </li>
    <li class="power">
        <i class="Place copperMedal"></i>
        <span>区块链王阿姨</span>
        <span>999.99</span>
        <span>99.99</span>
    </li>
    <li class="power">
        <i class="Place">4</i>
        <span>区块链王阿姨</span>
        <span>999.99</span>
        <span>99.99</span>
    </li>
    <li class="power">
        <i class="Place">5</i>
        <span>区块链王阿姨</span>
        <span>999.99</span>
        <span>99.99</span>
    </li>
    <li class="power">
        <i class="Place">6</i>
        <span>区块链王阿姨</span>
        <span>999.99</span>
        <span>99.99</span>
    </li>
    <li class="power">
    <i class="Place">7</i>
    <span>区块链王阿姨</span>
    <span>999.99</span>
    <span>99.99</span>
    </li>
    <li class="power">
    <i class="Place">8</i>
    <span>区块链王阿姨</span>
    <span>999.99</span>
    <span>99.99</span>
</li>
    <li class="power">
    <i class="Place">9</i>
    <span>区块链王阿姨</span>
    <span>999.99</span>
    <span>99.99</span>
</li>
    <li class="power">
    <i class="Place">10</i>
    <span>区块链王阿姨</span>
    <span>999.99</span>
    <span>99.99</span>
</li>-->
</ul>

<ul class="footer">
    <li class="community" style="border-right: 1px solid #ccc;">
        <div>
            <img src="../images/社区@2x.png">
        </div>
        <span class="blue">MI社区</span>
    </li>
    <li class="community" id="mycenter">
        <div>
            <img src="../images/人头拷贝2@2x副本.png">
        </div>
        <span class="gray">我的</span>
    </li>
</ul>


<script>
    // 跑马灯公告
    (function () {
        let marquee = '';
        $.ajax({
            type: 'GET',
            url: '/ads/gettextads',
            data: {},
            dataType: 'json',
            success: function(data){
                //console.log(data.data);
                if(data){
                    if(data.ret=='1'){
                        if(data.data){
                            $.each(data.data, function(index, item){
                                if(item.content){
                                    marquee += '<i class="empty"><a href="'+item.url+'" style="color: #fff;">'+item.title+'</a></i>';
                                }
                            });
                            $('.header').append(`<marquee>${marquee}</marquee>`);
                        }else{ // 返回的是空数据
                            return false;
                        }
                    }else{
                        if(data.errCode  = 4 ){
                            window.location.href="./passwordlogin.html";
                        }
                    }
                }
            },
            error: function(data){
                alert('发送失败！')
            }
        })
    })();
    // 排行榜
    (function () {
        $.ajax({
            type: 'GET',
            url: '/usercoin/getranklist',
            data: {},
            dataType: 'json',
            success: function(data){
                if(data.ret == '1' ) {  // 成功
                    if (data.data) { // 有数据
                        let html = data.data.map((item, index) => {
                            return `<li class="power">
                             <i class="Place">${(index == 0 || index == 1 || index == 2) ? '' : (index + 1)}</i>
                                               <span>${item.phone}</span>
                                               <span class="grey">${item.coin_total}</span>
                                               <span class="grey">${item.coin_power}</span>
                                            </li>`
                        });
                        $('.powerRankings').append(html.join(' '))
                    }
                    
                }else {
                    if(data.errCode  = 4 ){
                        window.location.href="./passwordlogin.html";
                    }
                }
            },
            error: function(data){
                alert('接口发送失败！')
            }   
        })  
    })();

    // 十分钟刷新数据
    setInterval(function () {
        rungking();
       // console.log(1);
    },600000);


    rungking();
    // 能量值
    function rungking() {
        $.ajax({
            type: 'GET',
            url: '/usercoin/getuserchargePowers',
            data: {},
            dataType: 'json',
            success: function (data) {
                 //console.log(data);
                let arr = [0, 1, 2, 3, 4, 5];
                let ra = Math.floor(Math.random() * 5);
                if (data.ret == '1') {  // 有数据
                    if (data.data) {
                        $('.total').text(data.data.coin_total);  // 能量
                        $('.totalPoewer').text(data.data.coin_power);  // 算力值

                        // 能量块
                        if (data.data.list[1]) {
                            var l = data.data.list[1];
                            for (var i = 0; i < l.length; i++) {
                                $('#y_' + arr[ra]).html(`<div id="x_${i}" class="random" value="${l[i].value}" coin_id="${l[i].coin_id}" release_time="${l[i].release_time}" onclick="aaa('x_${i}')"><img src="../images/能量.png"><span>${l[i].value}</span></div>`);
                                if (ra >= 5) {
                                    ra = 0;
                                }
                                else {
                                    ra++;
                                }
                            }
                        }
                    } else {
                        alert(data.msg)
                    }
                }
                else{
                    if(data.errCode  = 4 ){
                        window.location.href="./passwordlogin.html";
                    }
                }
            },
                error: function (data) {
                    alert('接口发送失败！')
                }
        });
    }


    // 当前点击的那个能量块
    function aaa(id){
       // let value = $('#'+id).attr('value');
        let coin_id = $('#'+id).attr('coin_id');
        let release_time = $('#'+id).attr('release_time');
        $('#audio')[0].play();

        // 点击事件结束后不能操作
        $('.mask').show();
        clearTimeout(mask);
       var mask =  setTimeout(function () {
           $('.mask').hide();
        },1000);
       /* $('#'+id).remove();*/
        $.ajax({
            type: 'POST',
            url: '/usercoin/usercharge',
            data:{coin_id:coin_id,release_time:release_time},
            dataType: 'json',
            success: function(data){
                //console.log(data);
                if(data.ret =='1'){  // 成功
                    //alert('收取成功！');
                    // 收取成功改变算力值
                    $('.total').text(data.data.coin_total);  // 能量
                    $('.totalPoewer').text(data.data.coin_power);  // 算力值
                    $('#'+id).remove();
                       for(var i=0;i<6;i++){
                           if($('#x_'+i).length !='0'){
                               return
                       }
                    }
                    rungking();
                    //console.log(data.data);
                }else{
                    alert(data.msg);
                }
            },
            error: function(data){
                alert('接口发送失败！')
            }
        })
    }

   // 提升算力
    $('.promotePower').on('click',function () {
        window.location.href="./promotePower.html";
    });
    //星球活动
    $('.activity').on('click',function () {
        window.location.href="./activity.html";
    });
    // 分享
    $('.share').on('click',function () {
        window.location.href="./share.html";
    });
    // 我的
    $('#mycenter').on('click',function () {
        window.location.href="./mycenter.html";
    });
</script>
</body>
</html>
